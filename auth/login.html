<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Log in â€” Pennyriser</title>
  <link rel="stylesheet" href="/assets/styles.css" />
</head>
<body>
  <header class="container"><h1>Pennyriser</h1></header>

  <main class="container">
    <article class="card" style="max-width:520px">
      <h2>Log in / Sign up</h2>

      <!-- Not a <form> (prevents auto-submit refresh) -->
      <label for="email">Email</label>
      <input id="email" type="email" placeholder="you@example.com" autocomplete="email" />

      <label for="password">Password</label>
      <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password" />

      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button id="loginBtn"  type="button" class="btn btn-primary">Log in</button>
        <button id="signupBtn" type="button" class="btn">Sign up</button>
        <a class="btn" href="/">Home</a>
      </div>

      <p id="msg" class="small" style="min-height:1.2em"></p>
      <p class="small">Educational only â€” not financial advice.</p>
    </article>
  </main>

  <!-- 1) Inline Firebase config to avoid missing-file issues -->
  <script>
    window.__FIREBASE_CONFIG__ = {
      apiKey: "AIzaSyCYFsmSWqZV583BFoUAOhOHge-iIZMgIuc",
      authDomain: "pennyriser-7c1a9.firebaseapp.com",
      projectId: "pennyriser-7c1a9",
      storageBucket: "pennyriser-7c1a9.firebasestorage.app",
      messagingSenderId: "627254669558",
      appId: "1:627254669558:web:58d185301ef142925c7cd7"
    };
  </script>

  <!-- 2) Load compat SDKs exactly once, after config -->
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>

  <!-- 3) Minimal, robust login logic -->
  <script>
  (function(){
    const say = (t)=>{ const m=document.getElementById('msg'); if(m) m.textContent=t; };

    try{
      if (!window.__FIREBASE_CONFIG__) { say('Missing Firebase config'); return; }
      if (!firebase?.apps?.length) firebase.initializeApp(window.__FIREBASE_CONFIG__);
    } catch(e){ console.error(e); say('Failed to init Firebase'); return; }

    const auth = firebase.auth();
    const email = document.getElementById('email');
    const pass  = document.getElementById('password');
    const loginBtn  = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');

    // Prevent accidental form submit refresh (we have no <form>, but belt & braces)
    [loginBtn, signupBtn].forEach(btn=>{
      btn?.addEventListener('click', ev => ev.preventDefault());
    });

    loginBtn?.addEventListener('click', async ()=>{
      try {
        await auth.signInWithEmailAndPassword(email.value.trim(), pass.value);
        say('Logged in. Taking you homeâ€¦');
        try { location.replace('/'); } catch(_) {}
        setTimeout(()=>location.assign('/'), 120);
      } catch (err) {
        console.error(err); say(err.message || 'Login failed');
      }
    });

    signupBtn?.addEventListener('click', async ()=>{
      try {
        await auth.createUserWithEmailAndPassword(email.value.trim(), pass.value);
        say('Account created. Now click Log in.');
      } catch (err) {
        console.error(err); say(err.message || 'Signup failed');
      }
    });

    // Optional: if already signed in, go home
    auth.onAuthStateChanged((user)=>{
      if (user) {
        say('You are already logged in. Taking you homeâ€¦');
        try { location.replace('/'); } catch(_) {}
        setTimeout(()=>location.assign('/'), 120);
      }
    });
  })();
  </script>
  <!-- Bottom Nav -->
<nav class="bottom-nav" role="navigation" aria-label="Primary">
  <ul>
    <li><a href="/" data-match="/">
      <span class="icon">ğŸ </span><span>Home</span>
    </a></li>
    <li><a href="/lessons/index.html" data-match="/lessons/">
      <span class="icon">ğŸ“š</span><span>Lessons</span>
    </a></li>
    <li><a href="/calculators/mortgage-overpayment.html" data-match="/calculators/">
      <span class="icon">ğŸ§®</span><span>Calculator</span>
    </a></li>
    <!-- Login / Logout (toggled by nav.js if Firebase available) -->
    <li><a id="bn-login" href="/auth/login.html">
      <span class="icon">ğŸ”‘</span><span>Log in</span>
    </a></li>
    <li><a id="bn-logout" href="/auth/login.html" hidden>
      <span class="icon">ğŸšª</span><span>Log out</span>
    </a></li>
    <!-- Admin (only shown for admins) -->
    <li><a id="bn-admin" href="/admin/index.html" data-match="/admin/" hidden>
      <span class="icon">ğŸ› ï¸</span><span>Admin</span>
    </a></li>
  </ul>
</nav>

<!-- Load AFTER your other scripts -->
<script src="/assets/nav.js"></script>

</body>
</html>
